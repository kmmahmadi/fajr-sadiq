import 'dart:convert';
import 'package:flutter/services.dart';

class AyahCounter {
  final int jozz;
  final int pos;
  final int total;
  final int remain;

  AyahCounter(this.jozz, this.pos, this.total, this.remain);
}

class KfgqpcSearch {
  static Map<int, AyahCounter> _cache = {};

  static Future<AyahCounter> counterForPage(int page) async {
    if (_cache.containsKey(page)) return _cache[page]!;

    final raw = await rootBundle.loadString('assets/kfgqpc/hafs_db.json');
    final List data = jsonDecode(raw);

    final ayat = data.where((e) => e['page'] == page).toList();
    if (ayat.isEmpty) return AyahCounter(0, 0, 0, 0);

    final jozz = ayat.first['jozz'];
    final juzAyat = data.where((e) => e['jozz'] == jozz).toList();

    final pos = juzAyat.indexOf(ayat.first) + 1;
    final total = juzAyat.length;
    final remain = total - pos;

    final res = AyahCounter(jozz, pos, total, remain);
    _cache[page] = res;
    return res;
  }
}